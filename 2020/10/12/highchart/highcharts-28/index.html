<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>資視就是力量 - Highcharts / Vue 做個記帳本 (上) | Max&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="既然已經掌握了 Highcharts-Vue 的基本使用技巧，那今明兩天打算帶大家來實作一個「記帳本」，用一個比較完整的應用來完結這個系列，也算是一個學習成果的回顧。  記帳本實作如下圖所示，第一天打算先把我們記帳本的介面、圖表及資料串接完成，畫面大致如上，上方為新增帳目的表單元件，下方則是顯示每日消費金額的柱狀圖，樣式的話大家可以自由發揮，文章中將只會說明程式邏輯的部分。     1.安裝 Js">
<meta property="og:type" content="article">
<meta property="og:title" content="資視就是力量 - Highcharts &#x2F; Vue 做個記帳本 (上)">
<meta property="og:url" content="https://maxleebk.com/2020/10/12/highchart/highcharts-28/index.html">
<meta property="og:site_name" content="Max&#39;s Blog">
<meta property="og:description" content="既然已經掌握了 Highcharts-Vue 的基本使用技巧，那今明兩天打算帶大家來實作一個「記帳本」，用一個比較完整的應用來完結這個系列，也算是一個學習成果的回顧。  記帳本實作如下圖所示，第一天打算先把我們記帳本的介面、圖表及資料串接完成，畫面大致如上，上方為新增帳目的表單元件，下方則是顯示每日消費金額的柱狀圖，樣式的話大家可以自由發揮，文章中將只會說明程式邏輯的部分。     1.安裝 Js">
<meta property="og:locale" content="zh">
<meta property="og:image" content="https://maxleebk.com/2020/10/12/highchart/highcharts-28/case.png">
<meta property="og:image" content="https://maxleebk.com/2020/10/12/highchart/highcharts-28/ledger.gif">
<meta property="article:published_time" content="2020-10-12T01:45:00.000Z">
<meta property="article:modified_time" content="2023-01-12T00:54:38.859Z">
<meta property="article:author" content="Max Lee">
<meta property="article:tag" content="JavaScript">
<meta property="article:tag" content="Highcharts">
<meta property="article:tag" content="12th鐵人賽">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://maxleebk.com/2020/10/12/highchart/highcharts-28/case.png">
  
    <link rel="alternate" href="/atom.xml" title="Max&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/css/images/favicon.ico">
  
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel="stylesheet">
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-landing">
      <a href="/" id="header-avatar"></a>
      <div id="header-title">
        <h1 id="logo-wrap">
          <a href="/" id="logo">Max&#39;s Blog</a>
        </h1>
        
          <h2 id="subtitle-wrap">
            <a href="/" id="subtitle">Max Your Mind</a>
          </h2>
        
      </div>
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Article</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
      </nav>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-highchart/highcharts-28" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        <div class="article-header-wrap">
          
  
    <h1 class="article-title" itemprop="name">
      資視就是力量 - Highcharts / Vue 做個記帳本 (上)
    </h1>
  

          <div>
            <p class="article-date">
  Posted by Max on
  <time datetime="2020-10-12T01:45:00.000Z" itemprop="datePublished">2020-10-12</time>
</p>
          </div>
        </div>
      </header>
    
    
        <div class="article-excerpt" itemprop="articleBody">
          <div class="post-cate">
            
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/" rel="tag">12th鐵人賽</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Highcharts/" rel="tag">Highcharts</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li></ul>

            
          </div>
          
        </div>
      
        <div class="article-entry" itemprop="articleBody">
          <p>既然已經掌握了 Highcharts-Vue 的基本使用技巧，那今明兩天打算帶大家來實作一個「記帳本」，用一個比較完整的應用來完結這個系列，也算是一個學習成果的回顧。</p>
<hr>
<h2 id="記帳本實作"><a href="#記帳本實作" class="headerlink" title="記帳本實作"></a>記帳本實作</h2><p>如下圖所示，第一天打算先把我們記帳本的介面、圖表及資料串接完成，畫面大致如上，上方為新增帳目的表單元件，下方則是顯示每日消費金額的柱狀圖，樣式的話大家可以自由發揮，文章中將只會說明程式邏輯的部分。</p>
<img src="case.png" style="max-width: 800px; margin: 16px auto 0;" />

<br/>

<h4 id="1-安裝-Json-Server"><a href="#1-安裝-Json-Server" class="headerlink" title="1.安裝 Json-Server"></a>1.安裝 Json-Server</h4><p>為了可以讓記帳本真的可以記帳，我們會需要資料庫來紀錄帳目，而我選擇使用的是 Json-Server，它讓我們可以用一個 Json 檔來作為簡易的資料庫，而且內建基本的 REST API 可以使用，這樣我們就不用真的架一個後端伺服器了，在終端機輸入下方指令就可以全域安裝了。</p>
<pre><code class="shell">npm install -g json-server</code></pre>
<p>安裝完成後新增一個 <code>db.json</code>，然後可以先手動新增一筆帳目，檔案內容如下：</p>
<pre><code class="json">{
  &quot;accounts&quot;: [
    {
      &quot;id&quot;: 1,
      &quot;category&quot;: &quot;伙食&quot;,
      &quot;amount&quot;: &quot;50&quot;,
      &quot;date&quot;: 1602028800000,
      &quot;description&quot;: &quot;早餐&quot;
    }
  ]
}</code></pre>
<p>檔案備妥後，在終端機輸入以下指令就可以啟動 <code>json-server</code>，這時候到 <code>http://localhost:3000/accounts</code>，就可以看到剛剛建立的資料了，未來只要是開啟伺服器的狀態就可以使用 API 來讀寫 <code>db.json</code> 的資料了。</p>
<pre><code class="shell">json-server db.json</code></pre>
<p><br/><br/></p>
<h4 id="2-安裝-axios"><a href="#2-安裝-axios" class="headerlink" title="2.安裝 axios"></a>2.安裝 axios</h4><p>資料庫有了之後，接下來在專案資料夾底下輸入終端機指令來安裝 <code>axios</code>，它可以讓我們更便捷的處理 XMLHttpRequest。</p>
<pre><code class="shell">npm install axios</code></pre>
<p>安裝好後到 <code>main.js</code> 添加以下程式碼來引用它，這樣我們就可以在元件裡使用 <code>this.axios.get()</code> 來呼叫 API 了。</p>
<pre><code class="javascript">import Vue from &quot;vue&quot;;
import axios from &quot;axios&quot;;
Vue.prototype.axios = axios;</code></pre>
<p><br/><br/></p>
<h4 id="3-Highcharts-全域設定"><a href="#3-Highcharts-全域設定" class="headerlink" title="3.Highcharts 全域設定"></a>3.Highcharts 全域設定</h4><p>由於這次的應用會使用到日期座標，所以我們可以來調整一下「語言設定」，設定方法是在 <code>main.js</code> 引入原生 Highcharts，然後一樣是呼叫 <code>setOptions()</code>。</p>
<pre><code class="javascript">import Vue from &quot;vue&quot;;
import Highcharts from &quot;highcharts&quot;;

Highcharts.setOptions({
  lang: {
    shortMonths: [&quot;1月&quot;, &quot;2月&quot;, ..., &quot;12月&quot;],
    weekdays: [&quot;星期日&quot;, &quot;星期一&quot;, ..., &quot;星期六&quot;],
  },
  // 也可增加其他你像要的全域設定
  credits: { enabled: false },
  colors: [...]
});</code></pre>
<p><br/><br/></p>
<h4 id="4-表單元件-LedgerForm-vue"><a href="#4-表單元件-LedgerForm-vue" class="headerlink" title="4.表單元件 - LedgerForm.vue"></a>4.表單元件 - LedgerForm.vue</h4><p>前置作業完成後就可以來開發元件了，首先是上方用來新增帳目的表單元件。新增一個檔案內容如下的元件，其中四個表單欄位剛好對應資料庫的內容，而點擊按鈕觸發的 <code>addItem</code> 就是用 <code>axios</code> 送出 <code>post</code> 請求，便會在資料庫添加一筆新的帳目。</p>
<br/>

<p><strong>對了，為了把重點放在圖表的應用上，有許多部分是被我省略的：</strong></p>
<ol>
<li>為了省去畫面處理的邏輯，我故意使用 Form 表單，讓資料送出時會自動刷新頁面，這部分的使用體驗可以再改善。</li>
<li>表單驗證的部分也被我省略了，為了防止錯誤的資料格式存進資料庫，再請各位自行撰寫。</li>
</ol>
<pre><code class="vue">&lt;template&gt;
  &lt;form&gt;
    &lt;fieldset&gt;
      &lt;legend&gt;新增帳目&lt;/legend&gt;
      &lt;div class=&quot;input-group&quot;&gt;
        &lt;label&gt;日期&lt;/label&gt;
        &lt;input type=&quot;date&quot; v-model=&quot;date&quot;&gt;
        &lt;label&gt;分類&lt;/label&gt;
        &lt;select v-model=&quot;category&quot;&gt;
          &lt;option value=&quot;伙食&quot;&gt;伙食&lt;/option&gt;
          &lt;option value=&quot;交通&quot;&gt;交通&lt;/option&gt;
          &lt;option value=&quot;生活&quot;&gt;生活&lt;/option&gt;
          &lt;option value=&quot;帳單&quot;&gt;帳單&lt;/option&gt;
          &lt;option value=&quot;娛樂&quot;&gt;娛樂&lt;/option&gt;
        &lt;/select&gt;
        &lt;label&gt;金額&lt;/label&gt;
        &lt;input type=&quot;number&quot; v-model.number=&quot;amount&quot;&gt;
      &lt;/div&gt;
      &lt;div class=&quot;input-group&quot;&gt;
        &lt;label&gt;說明&lt;/label&gt;
        &lt;input type=&quot;text&quot; v-model=&quot;description&quot;&gt;
      &lt;/div&gt;
      &lt;button @click=&quot;addItem&quot;&gt;+&lt;/button&gt;
    &lt;/fieldset&gt;
  &lt;/form&gt;
&lt;/template&gt;

&lt;script&gt;
  export default {
    data() {
      return {
        date: &quot;&quot;,
        category: &quot;伙食&quot;,
        amount: 0,
        description: &quot;&quot;
      }
    },
    methods: {
      addItem() {
        this.axios.post(&quot;http://localhost:3000/accounts&quot;, {
          date: new Date(this.date).getTime(),
          category: this.category,
          amount: this.amount,
          description: this.description
        })
      }
    }
  }
&lt;/script&gt;</code></pre>
<p><br/><br/></p>
<h4 id="5-圖表元件-LedgerChart-vue"><a href="#5-圖表元件-LedgerChart-vue" class="headerlink" title="5.圖表元件 - LedgerChart.vue"></a>5.圖表元件 - LedgerChart.vue</h4><p><strong>可以紀錄帳目後，就要讓消費記錄透過圖表呈現出來了，而需求規格有以下幾點：</strong></p>
<ol>
<li>每一個支出類別都是一組數據列，例如伙食、娛樂、交通..等。</li>
<li>圖表為柱狀圖，不同數據列需要疊加，以便觀察每日總消費的起伏。</li>
<li>Ｘ軸為日期座標軸，並且顯示只顯示從今天算起的前七天。</li>
</ol>
<blockquote>
<p>避免模糊焦點，這次圖表只做到近七天的資料顯示，有興趣的話你也可以根據自己你想法改善這個範例。</p>
</blockquote>
<p>根據需求，我們先準備好需要的資料，包括儲存今日時間戳的 <code>todayTimeStamp</code>，儲存 API 資料的 <code>fetchData</code>，以及圖表設定 <code>chartOptions</code>。</p>
<pre><code class="javascript">data() {
  return {
    todayTimeStamp: 0,
    fetchData: [],
    chartOptions: {
      chart: { type: &quot;column&quot; },
      title: { text: &quot;每日消費&quot; },
      tooltip: {
        shared: true,
        headerFormat: &quot;{point.key:%Y/%m/%d %A}&lt;br/&gt;&quot;,
        valuePrefix: &quot;NT$&quot;
      },
      xAxis: {
        type: &quot;datetime&quot;,
        categories: [],
        labels: { format: &quot;{value:%b%d}日&quot; },
      },
      yAxis: {
        title: undefined,
        labels: { format: &quot;NT$ {value}&quot; },
      },
      plotOptions: {
        series: { stacking: &quot;normal&quot; }
      },
      series: [],
    }
  };
}</code></pre>
<p>而API資料我們需要再 <code>created</code> 時先去取得，順便把今天的時間戳儲存起來，方便我們之後計算近七天的時間。</p>
<pre><code class="javascript">created() {
  // 取得當日的時間戳
  let now = new Date().getTime();
  this.todayTimeStamp = now - now  % 86400000;
  // call json-server api
  this.axios.get(&quot;http://localhost:3000/accounts&quot;).then((response) =&gt; {
    this.fetchData = response.data;
  });
},</code></pre>
<p>有了這些資料後，就可以透過 <code>computed</code> 來將資料處理成我們所需的格式了。</p>
<pre><code class="javascript">computed: {
  // 利用當日時間戳來計算Ｘ軸所需的 categories 陣列
  xAxisCategories() {
    return Array(7).fill(0).map((date ,index) =&gt; {
      return this.todayTimeStamp - 86400000 * index
    }).reverse()
  },
  // 抓出所有不重複的支出類別
  expendType() {
    let allType = this.fetchData.map(item =&gt; item.category);
    return Array.from(new Set(allType));
  },
  // 把 API 資料 map 成我們需要的格式
  seriesData() {
    return this.expendType.map(cate =&gt; {
      let itemByCate = this.fetchData.filter(item =&gt; item.category === cate);
      let points = this.xAxisCategories.map(date =&gt; {
        return itemByCate.reduce((acc, item) =&gt; {
          return item.date === date ? acc + Number(item.amount) : acc
        }, 0)
      })
      return { name: cate, data: points };
    });
  },
  // 將圖表設定和處理完的資料合併
  options() {
    let options = Object.assign(this.chartOptions, {});
    options.series = this.seriesData;
    options.xAxis.categories = this.xAxisCategories;
    return options;
  }
}</code></pre>
<p>最後把 <code>options</code> 傳入圖表，並且記得把今天新增的兩個元件掛載到 <code>App.vue</code> 上，就可以看到消費紀錄呈現在圖表上囉。</p>
<pre><code class="html">&lt;template&gt;
  &lt;div class=&quot;chart-container&quot;&gt;
    &lt;div v-if=&quot;!fetchData.length&quot; class=&quot;noData&quot;&gt;無任何消費記錄&lt;/div&gt;
    &lt;highcharts v-else :options=&quot;options&quot;&gt;&lt;/highcharts&gt;
  &lt;/div&gt;
&lt;/template&gt;</code></pre>
<img src="ledger.gif" style="max-width: 800px; margin: 16px auto 0;" />

<p><br/><br/></p>
<p>辛苦各位了，今天的篇幅比較長，不過跟著今天一步步的流程下來，終於完成了一個比較完整的 Highcharts-Vue 應用，而明天我們將利用「事件屬性」來為這個應用再添加一個小功能。</p>
<hr>
<p>- 此篇文章為「iT邦幫忙鐵人賽」參賽文章，同步發表於 <a href="https://ithelp.ithome.com.tw/articles/10252336" target="_blank" rel="noopener">iT邦幫忙</a> -</p>

        </div>
      
    
  </div>

  <footer class="article-footer">
    <!-- 
      <a href="https://maxleebk.com/2020/10/12/highchart/highcharts-28/#disqus_thread" class="article-comment-link">Comments</a>
     -->
    <div>
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/" rel="tag">12th鐵人賽</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Highcharts/" rel="tag">Highcharts</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li></ul>

    </div>
    <a data-url="https://maxleebk.com/2020/10/12/highchart/highcharts-28/" data-id="clcsdp5ld002eneqw6ipj11ip" class="article-share-link">分享</a>
  </footer>
  
    
<nav id="article-nav">
  
    <div id="article-nav-older" class="article-nav-link-wrap">
      
      <strong class="article-nav-caption">前一篇文章</strong></br>
      <a href="/2020/10/11/highchart/highcharts-27/" class="article-nav-title">資視就是力量 - Highcharts / Vue 資料綁定</a>
      
    </div>
  
  
    <div id="article-nav-newer" class="article-nav-link-wrap">
      
      <strong class="article-nav-caption">下一篇文章</strong></br>
      <a href="/2020/10/13/highchart/highcharts-29/" class="article-nav-title">
        
          資視就是力量 - Highcharts / Vue 做個記帳本 (下)
        
      </a>
      
    </div>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" target="_blank" rel="noopener">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2023 Max Lee ｜ Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Article</a>
  
</nav>
    
<script>
  var disqus_shortname = 'f820602h';
  
  var disqus_url = 'https://maxleebk.com/2020/10/12/highchart/highcharts-28/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>

<!-- Highlight.js -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@latest/build/styles/vs2015.min.css">
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@latest/build/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>